<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Control Juegos</title>
</head>
<body>
    <h2>Panel de Control</h2>
    <input type="text" id="search-input" placeholder="Escribe un juego...">
    <button onclick="updateGame()">Actualizar</button>

    <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAETEV6tMlu7v6RHUURfpH0f_NkOeBNVk0",
        authDomain: "fuenteobstest.firebaseapp.com",
        projectId: "fuenteobstest",
        storageBucket: "fuenteobstest.firebasestorage.app",
        messagingSenderId: "734398629121",
        appId: "1:734398629121:web:7bccef8044f132be62c700",
        measurementId: "G-KM4YV86E1V"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function updateGame() {
      const query = document.getElementById("search-input").value.trim();
      if (!query) return;

        const API_KEY = "ee55dcab966c4a6180c75eae52a67abe"; // API de RAWG
      const url = `https://api.rawg.io/api/games?key=${API_KEY}&search=${encodeURIComponent(query)}&page_size=1`;

      const res = await fetch(url);
      const data = await res.json();
      const game = data.results[0];
      if (!game) {
        alert("Juego no encontrado");
        return;
      }

      // Guardar en Firestore
      await setDoc(doc(db, "overlay", "currentGame"), {
        name: game.name,
        img: game.background_image,
        platforms: game.platforms?.map(p => p.platform.name).join(", "),
        genres: game.genres?.map(g => g.name).join(", "),
        year: game.released?.split("-")[0] || "Desconocido"
      });

      alert("Juego actualizado en OBS");
    }
    </script>
</body>
</html>
